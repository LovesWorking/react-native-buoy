# React Buoy Release Workflow

This document describes how to publish the `@react-buoy/*` packages using the Changesets-driven pipeline we set up.

---

## Prerequisites

1. **NPM Access**
   - The releasing engineer must have publish rights to the `@react-buoy` scope and an npm auth token configured locally or in CI.

2. **Clean `main`**
   - Ensure `git status` is clean and you are on the latest `main` branch before releasing.

---

## Daily Development

1. Implement your feature/fix.
2. Run the quality pipeline locally:
   ```bash
   pnpm run lint
   pnpm run typecheck
   pnpm run build:packages
   pnpm run smoke
   ```
3. Record a changeset for any publishable change:
   ```bash
   pnpm changeset
   ```
   - Select the affected package(s).
   - Choose the correct bump (patch/minor/major).
   - Commit the generated file under `.changeset/`.
4. Open your pull request. CI (`.github/workflows/ci.yml`) will run lint/typecheck/build/smoke and confirm a changeset exists.

---

## Before Each Release

1. **Review Pending Changesets**
   ```bash
   pnpm changeset status --verbose
   ```
   - Inspect which packages will publish and the changelog summaries.

2. **Optional GitHub Dry Run**
   - Trigger the “Release Dry Run” workflow (`.github/workflows/release-dry-run.yml`).
   - It runs install → lint → typecheck → build → smoke → `pnpm changeset publish --dry-run --no-git-tag` so you can validate credentials and see what would publish.

3. **Documentation Touch-Ups**
   - Update package READMEs or changelogs if you want additional release notes.

---

## Cutting a Release

Run the helper script from a clean `main`:
```bash
pnpm run release
```
The script performs:
1. Clean working tree check.
2. `pnpm install --frozen-lockfile`.
3. `pnpm run lint`.
4. `pnpm run typecheck`.
5. `pnpm run build:packages`.
6. `pnpm run smoke`.
7. `pnpm changeset version` (applies pending changesets; bumps versions; updates changelogs).
8. `pnpm install` again to refresh lockfiles.
9. Creates the commit `chore: release` (if changes are present).
10. `pnpm changeset publish` (publishes updated packages to npm).

After the script completes:
```bash
git push origin main --follow-tags
```
This pushes the release commit and the git tags generated by Changesets.

### Need to bump everything?

If you’d rather publish every package with a patch bump—no matter which ones changed—use the bulk script. It will generate a patch changeset for every workspace, run the quality checks, publish sequentially, and push commits/tags for you:
```bash
pnpm run release:all
```
> This script assumes you want to publish immediately; it auto-commits, publishes each package one at a time, and calls `git push`/`git push --follow-tags` on success.

---

## First Release Guidance

- If no version has shipped yet, create a bootstrap changeset covering all packages (choose patch/minor as appropriate) before running `pnpm run release`.
- Once the release completes, npm will contain the first `@react-buoy/*` packages with changelogs.

---

## Ongoing Releases

1. Continue recording changesets per change.
2. Optionally run the dry-run workflow in GitHub Actions before releasing.
3. Run `pnpm run release` from `main` to cut the next release.
4. Push the release commit and tags.

---

## CI Overview

- `CI` workflow: executes lint → typecheck → build → smoke on every PR and push to `main`.
- `Changeset Status` job: runs on PRs to ensure a changeset exists when packages change.
- `Release Dry Run` workflow: manual trigger replicating the release sequence with a dry-run publish.

---

## Commands Reference

```bash
# View pending changesets and affected packages
pnpm changeset status --verbose

# Run local release (lint, typecheck, build, smoke, version, publish)
pnpm run release

# Force patch release for every package (auto pushes on success)
pnpm run release:all

# Manual quality checks
pnpm run lint
pnpm run typecheck
pnpm run build:packages
pnpm run smoke

# Manual dry run publish (without tags/commit)
pnpm changeset publish --dry-run --no-git-tag
```

---

With this workflow, releases remain consistent and automated—collect changesets, validate with the helper scripts or CI, then run `pnpm run release` and push tags when you’re ready to ship.
